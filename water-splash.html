<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Water Splash Sound Effect</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #87CEEB;
      overflow: hidden;
    }
    
    .container {
      position: relative;
      width: 500px;
      height: 500px;
      cursor: pointer;
      background-color: #1E90FF;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .splash-container {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .splash-image {
      position: absolute;
      max-width: 100%;
      max-height: 100%;
      opacity: 0;
      transform: scale(0.8);
      transition: opacity 0.5s, transform 0.5s;
      z-index: 3;
    }
    
    .splash-image.active {
      opacity: 1;
      transform: scale(1);
    }
    
    .water {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 150px;
      background-color: #1E90FF;
    }
    
    .character {
      position: absolute;
      width: 50px;
      height: 80px;
      background-color: #FF6347;
      border-radius: 50% 50% 0 0;
      top: 150px;
      transform: translateY(0);
      transition: transform 0.5s;
      z-index: 2;
    }
    
    .character.diving {
      transform: translateY(220px);
    }
    
    .instructions {
      margin-top: 20px;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 5px;
      text-align: center;
    }
    
    .droplets {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #87CEEB;
      border-radius: 50%;
      opacity: 0;
    }

    /* No longer needed as we're using dive.png */
  </style>
</head>
<body>
  <h1>Water Splash Sound Effect</h1>
  <div class="container" id="soundCanvas">
    <div class="character" id="character"></div>
    <div class="water"></div>
    <div class="splash-container">
      <img src="dive.png" class="splash-image" id="splashImage" alt="Water Splash">
    </div>
  </div>
  <div class="instructions">
    <p>Click on the blue area to hear a water splash sound effect and see the animation!</p>
    <p>The sound uses oscillators, noise, filters, envelopes, and LFO modulation.</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Tone.js
      const soundCanvas = document.getElementById('soundCanvas');
      const character = document.getElementById('character');
      const splashImage = document.getElementById('splashImage');
      
      // Create the audio components
      
      // 1. Noise generator for the splash
      const noise = new Tone.Noise("white").start();
      const noiseFilter = new Tone.Filter({
        type: "lowpass", 
        frequency: 2000, 
        Q: 5
      });
      
      // 2. Envelope for the noise (splash)
      const splashEnvelope = new Tone.AmplitudeEnvelope({
        attack: 0.01,
        decay: 0.2,
        sustain: 0.3,
        release: 0.8
      });
      
      // Filter envelope to modulate the noise filter
      const filterEnvelope = new Tone.FrequencyEnvelope({
        attack: 0.01,
        decay: 0.3,
        sustain: 0.1,
        release: 0.7,
        baseFrequency: 300,
        octaves: 4
      });
      
      // Connect filter envelope to the noise filter frequency
      filterEnvelope.connect(noiseFilter.frequency);
      
      // 3. Oscillator for the "plunge" sound
      const plungeOsc = new Tone.Oscillator({
        type: "sine", 
        frequency: 300
      });
      
      // Plunge envelope
      const plungeEnvelope = new Tone.AmplitudeEnvelope({
        attack: 0.01,
        decay: 0.3,
        sustain: 0.1,
        release: 0.5
      });
      
      // Frequency envelope for the plunge (pitch drop effect)
      const plungeFreqEnv = new Tone.FrequencyEnvelope({
        attack: 0.01,
        decay: 0.3,
        sustain: 0,
        release: 0.2,
        baseFrequency: 400,
        octaves: -2
      });
      
      // 4. Bubbles oscillator
      const bubblesOsc = new Tone.Oscillator({
        type: "sine",
        frequency: 800
      });
      
      // Bubbles envelope
      const bubblesEnvelope = new Tone.AmplitudeEnvelope({
        attack: 0.3,
        decay: 0.2,
        sustain: 0.1,
        release: 0.5
      });
      
      // 5. LFO for bubble modulation
      const bubbleLFO = new Tone.LFO({
        frequency: 10,
        min: 600,
        max: 1200
      });
      
      // Connect bubbleLFO to the bubbles oscillator frequency for modulation
      bubbleLFO.connect(bubblesOsc.frequency);
      
      // 6. Effect chain: reverb for ambience
      const reverb = new Tone.Reverb({
        decay: 1.5,
        wet: 0.3
      });
      
      // Connect audio nodes
      noise.connect(noiseFilter);
      noiseFilter.connect(splashEnvelope);
      plungeOsc.connect(plungeEnvelope);
      plungeFreqEnv.connect(plungeOsc.frequency);
      bubblesOsc.connect(bubblesEnvelope);
      
      // Final output chain with reverb
      splashEnvelope.connect(reverb);
      plungeEnvelope.connect(reverb);
      bubblesEnvelope.connect(reverb);
      reverb.toDestination();
      
      // Load reverb
      reverb.generate();
      
      // Function to show/hide the splash image
      function showSplashImage(show) {
        if (show) {
          splashImage.classList.add('active');
        } else {
          splashImage.classList.remove('active');
        }
      }
      
      // Function to play the water splash sound
      async function playWaterSplash() {
        // Request audio context to be resumed (needed for browsers that require user interaction)
        await Tone.start();
        
        // Start the oscillators
        plungeOsc.start();
        bubblesOsc.start();
        bubbleLFO.start();
        
        // Trigger the envelopes
        plungeEnvelope.triggerAttackRelease(0.5);
        plungeFreqEnv.triggerAttackRelease(0.5);
        
        // Slightly delay the splash sound
        setTimeout(() => {
          splashEnvelope.triggerAttackRelease(0.7);
          filterEnvelope.triggerAttackRelease(0.7);
        }, 100);
        
        // Delay the bubbles sound
        setTimeout(() => {
          bubblesEnvelope.triggerAttackRelease(0.5);
        }, 200);
        
        // Stop the oscillators after the sound is complete
        setTimeout(() => {
          plungeOsc.stop();
          bubblesOsc.stop();
          bubbleLFO.stop();
        }, 1500);
      }
      
      // Function to create and animate the splash
      function animateSplash() {
        // Character diving animation
        character.classList.add('diving');
        
        // Show the splash image
        showSplashImage(true);
        
        // Reset the character position and hide splash after animation
        setTimeout(() => {
          character.classList.remove('diving');
          showSplashImage(false);
        }, 1500);
      }
      
      // Event listener for the canvas click
      soundCanvas.addEventListener('click', function() {
        playWaterSplash();
        animateSplash();
      });
      
      // Make sure the splash image is initially hidden
      showSplashImage(false);
    });
  </script>
</body>
</html>